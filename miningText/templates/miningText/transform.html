{% extends 'miningText/base.html' %}
{% block content %}

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 min-h-[80vh]">
<!-- COLONNE GAUCHE : Liste des articles -->
    <div class="bg-white rounded-xl shadow p-4 overflow-y-auto">    

        <div class="flex flex-wrap items-center justify-between mb-4 gap-2">
    <!-- Titre à gauche -->
    <h2 class="text-lg font-semibold text-gray-800">
        Discours
    </h2>

    <!-- Input et bouton à droite -->
    <div class="relative flex items-center gap-2">
         <!-- Bouton Ajouter -->
        <a href="{% url 'create' %}" 
           class="px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition">
           +Ajouter
        </a>
            <!-- Champ de recherche -->
          <input
            type="text"
            id="searchInput"
            placeholder="Rechercher (titre, auteur, contenu...)"
            class="flex-1 px-3 py-2 text-sm border rounded-lg
                   focus:outline-none focus:ring-2 focus:ring-blue-300"
        />

         <button
        id="clearSearch"
        type="button"
        class="absolute right-2 top-1/2 -translate-y-1/2 text-white bg-red-600 hover:bg-red-700 px-0.3 py-0.3 rounded-lg z-5 hidden"
        title="Effacer la recherche"
    >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
    </button>

    </div>
</div>


<ul id="article-list" class="space-y-2">
    {% for article in articles %}
        {% include "miningText/partials/article_item.html" %}
    {% endfor %}
</ul>

    </div>

    <!-- COLONNE CENTRALE : Détail article -->
    <div id="article-detail" class="bg-white rounded-xl shadow p-6 overflow-y-auto">
        <p class="text-gray-400 italic text-center">
            Sélectionnez un article pour afficher le contenu
        </p>
    </div>

    <!-- COLONNE DROITE : Analyse article -->
    <div id="article-analyse" class="bg-white rounded-xl shadow p-6 overflow-y-auto ">
        <p class="text-gray-400 italic text-center">
            Analyse du contenu
        </p>
    </div>
</div>


<!-- ⚙️ SCRIPT -->
<script>
function loadArticle(id, btn) {
    // Surbrillance
    document.querySelectorAll('.article-btn').forEach(b => {
        b.classList.remove('bg-blue-100', 'border-blue-400');
    });
    btn.classList.add('bg-blue-100', 'border-blue-400');

    // Chargement AJAX
    fetch(`/miningText/ajax/article/${id}/`)
        .then(response => response.json())
        .then(data => {
            // Injection séparée
            document.getElementById("article-detail").innerHTML = data.article_html;
            document.getElementById("article-analyse").innerHTML = data.analyse_html;
        });
}

</script>

<script>
const searchInput = document.getElementById("searchInput");
const articleList = document.getElementById("article-list");
const clearBtn = document.getElementById("clearSearch");

let timer = null;

// Afficher/masquer le bouton clear
searchInput.addEventListener("input", () => {
    if(searchInput.value.trim() !== "") {
        clearBtn.classList.remove("hidden");
    } else {
        clearBtn.classList.add("hidden");
    }
});

// Bouton clear
clearBtn.addEventListener("click", () => {
    searchInput.value = "";
    clearBtn.classList.add("hidden");
    fetch(`/miningText/search/?q=`)
        .then(response => response.text())
        .then(html => {
            articleList.innerHTML = html;
        });
});

searchInput.addEventListener("input", function () {
    clearTimeout(timer);

    timer = setTimeout(() => {
        const query = searchInput.value.trim();

        fetch(`/miningText/search/?q=${encodeURIComponent(query)}`)
            .then(response => response.text())
            .then(html => {
                articleList.innerHTML = html;
            });
    }, 300); // debounce doux
});
</script>




{% endblock %}