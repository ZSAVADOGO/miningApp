{% extends 'miningText/base.html' %}

{% block content %}


<div class="relative flex items-center justify-center mb-2">
    <a href="{% url 'create' %}" class="absolute left-0 bg-blue-600 text-white px-4 py-1 rounded-lg hover:bg-blue-700 transition">
        +Ajouter
    </a>

     <h2 class="text-2xl font-semibold px-6  text-gray-900">
        Liste des discours
    </h2>

<div class="relative w-64">
    <input
        type="text"
        id="searchInputIndex"
        placeholder="Rechercher (titre, auteur, contenu...)"
        class="w-full px-3 py-2 pr-10 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300"
    />
   <button
        id="clearSearch"
        type="button"
        class="absolute right-2 top-1/2 -translate-y-1/2 text-white bg-red-600 hover:bg-red-700 px-0.5 py-0.5 rounded-lg z-5 hidden"
        title="Effacer la recherche"
    >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
    </button>
</div>

   
</div>


<div id="article-list-index">
    {% include "miningText/partials/article_list_index.html" %}
</div>




<script>
const input = document.getElementById("searchInputIndex");
const list = document.getElementById("article-list-index");
const clearBtn = document.getElementById("clearSearch");

// Afficher/masquer le bouton clear
input.addEventListener("input", () => {
    if(input.value.trim() !== "") {
        clearBtn.classList.remove("hidden");
    } else {
        clearBtn.classList.add("hidden");
    }
});

let timer = null;

input.addEventListener("keyup", () => {
    clearTimeout(timer);

    timer = setTimeout(() => {
        fetch(`/miningText/search_index/?q=${encodeURIComponent(input.value)}`)
    .then(res => res.json())
    .then(data => {
        document.getElementById("article-list-index").innerHTML = data.html;
    });

    }, 300); // anti-spam serveur
});

// Bouton clear
clearBtn.addEventListener("click", () => {
    input.value = "";
    fetch(`/miningText/search_index/?q=`) // envoi vide pour récupérer tout
        .then(res => res.json())
        .then(data => {
            list.innerHTML = data.html;
        });
    clearBtn.classList.add("hidden"); // masque le bouton après clic
});

</script>


{% endblock %}
