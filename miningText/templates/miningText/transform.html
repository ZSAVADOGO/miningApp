{% extends 'miningText/base.html' %}
{% block content %}

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 min-h-[80vh]">
{% comment %} <div class="grid grid-cols-[2fr_3fr_3fr] gap-6 min-h-[80vh]"> {% endcomment %}
<!-- COLONNE GAUCHE : Liste des articles -->
    <div class="bg-white rounded-xl shadow p-4 overflow-y-auto">    

        <div class="flex flex-wrap items-center justify-between mb-4 gap-2">
    <!-- Titre à gauche -->
    <h2 class="text-lg font-semibold text-gray-800">
        Discours
    </h2>

    <!-- Input et bouton à droite -->
    <div class="flex items-center gap-2">
         <!-- Bouton Ajouter -->
        <a href="{% url 'create' %}" 
           class="px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition">
           +Ajouter
        </a>
        <!-- Input recherche -->
        {% comment %} <input 
            type="text" 
            placeholder="Rechercher..." 
            class="px-3 py-1.5 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
        > {% endcomment %}
          <input
            type="text"
            id="searchInput"
            placeholder="Rechercher (titre, auteur, contenu...)"
            class="flex-1 px-3 py-2 text-sm border rounded-lg
                   focus:outline-none focus:ring-2 focus:ring-blue-300"
        />

    </div>
</div>


       {% comment %}  <ul class="space-y-2">
            {% for article in articles %}

            <li>
    <div onclick="loadArticle({{ article.id }}, this)"
         class="article-btn cursor-pointer w-full px-3 py-2 rounded-lg border
                hover:bg-blue-50 transition text-sm">

        <p class="font-medium text-gray-800 truncate">
            {{ article.titre }} • {{ article.auteur }}
        </p>

        <div class="flex items-center justify-between text-xs text-gray-500 mt-1">

            <!-- GAUCHE : date -->
            <span>
                {{ article.date_publication|date:"d/m/Y" }}
            </span>

            <!-- DROITE : actions -->
            <div class="flex items-center gap-1">
                <a href="{% url 'update' article.id %}"
                   class="px-2 py-0.5 bg-green-700 text-white rounded
                          hover:bg-green-800 transition text-[11px]">
                    Modif
                </a>

                <a href="{% url 'delete' article.id %}"
                   class="px-2 py-0.5 bg-red-600 text-white rounded
                          hover:bg-red-700 transition text-[11px]">
                    Supp
                </a>
            </div>

        </div>
    </div>
</li>

            {% endfor %}
        </ul> {% endcomment %}
<ul id="article-list" class="space-y-2">
    {% for article in articles %}
        {% include "miningText/partials/article_item.html" %}
    {% endfor %}
</ul>

    </div>

    <!-- COLONNE CENTRALE : Détail article -->
    <div id="article-detail" class="bg-white rounded-xl shadow p-6 overflow-y-auto">
        <p class="text-gray-400 italic text-center">
            Sélectionnez un article pour afficher le contenu
        </p>
    </div>

    <!-- COLONNE DROITE : Analyse article -->
    <div id="article-analyse" class="bg-white rounded-xl shadow p-6 overflow-y-auto ">
        <p class="text-gray-400 italic text-center">
            Analyse du contenu
        </p>
    </div>
</div>


<!-- ⚙️ SCRIPT -->
<script>
function loadArticle(id, btn) {
    // Surbrillance
    document.querySelectorAll('.article-btn').forEach(b => {
        b.classList.remove('bg-blue-100', 'border-blue-400');
    });
    btn.classList.add('bg-blue-100', 'border-blue-400');

    // Chargement AJAX
    fetch(`/miningText/ajax/article/${id}/`)
        .then(response => response.json())
        .then(data => {
            // Injection séparée
            document.getElementById("article-detail").innerHTML = data.article_html;
            document.getElementById("article-analyse").innerHTML = data.analyse_html;
        });
}

</script>

<script>
const searchInput = document.getElementById("searchInput");
const articleList = document.getElementById("article-list");

let timer = null;

searchInput.addEventListener("input", function () {
    clearTimeout(timer);

    timer = setTimeout(() => {
        const query = searchInput.value.trim();

        fetch(`/miningText/search/?q=${encodeURIComponent(query)}`)
            .then(response => response.text())
            .then(html => {
                articleList.innerHTML = html;
            });
    }, 300); // debounce doux
});
</script>




{% endblock %}